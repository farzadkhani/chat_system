<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Notify Me</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

</head>

<body>
    {% comment %} <h1>Lets chat!</h1> {% endcomment %}

    {% comment %} <form id="form">
        <input type="text" name="message" />
    </form> {% endcomment %}

    {% comment %} <div id="messages"></div> {% endcomment %}

    <h1>Notifications</h1>
    {% comment %} <form id="form2">
        <input type="text" name="token" />
    </form> {% endcomment %}
    <div id="notifications"></div>

    <script type="text/javascript">
        var token = prompt("Enter token:", "")
        function handle_chat() {
            let url = `ws://${window.location.host}/ws/socket-server/`

            const chatSocket = new WebSocket(url)

            chatSocket.onmessage = function (e) {
                let data = JSON.parse(e.data)
                console.log('Data:', data)

                if (data.type === 'chat') {
                    let messages = document.getElementById('messages')

                    messages.insertAdjacentHTML('beforeend', `<div>
                                            <p>${data.message}</p>
                                        </div>`)
                }
            }

            let form = document.getElementById('form')
            form.addEventListener('submit', (e) => {
                e.preventDefault()
                let message = e.target.message.value
                chatSocket.send(JSON.stringify({
                    'message': message
                }))
                form.reset()
            })
        }

        // handle_chat();

        function handle_notification() {
            let form = document.getElementById('form2')
            let url = `ws://${window.location.host}/ws/notification/?token=${token}`

            const notificationSocket = new WebSocket(url)

            notificationSocket.onmessage = function (e) {
                let data = JSON.parse(e.data)

                if (data.type === 'notification') {
                    let messages = document.getElementById('notifications')

                    messages.insertAdjacentHTML('beforeend', `<div>
                                            <p>${data.data}</p>
                                        </div>`)
                }
            }
        }
        handle_notification();
    </script>
</body>

</html>